---
title: "data_analysis"
output: html_document
---

```{r}
NHANES_screen <- NHANES |>
  filter(Gender == "male" & Age >= 18) |>
  select(c("ID", "Gender", 'Testosterone', 'Depressed', "Age","CompHrsDay", 'TVHrsDay', 'BMI', 'LittleInterest', 'SleepHrsNight', 'HHIncome', 'PhysActive'))
  

  NHANES_screen
```


```{r}
df <- NHANES_screen |> 
  distinct() |> 
  mutate(
    TV_Numeric = case_when(
      TVHrsDay == "0_hrs" ~ 0,
      TVHrsDay == "1_hr" ~ 1,
      TVHrsDay == "2_hr" ~ 2,
      TVHrsDay == "3_hr" ~ 3,
      TVHrsDay == "4_hr" ~ 4,
      TVHrsDay == "More_4_hr" ~ 5,
      TRUE ~ NA_real_ 
    ),
    Comp_Numeric = case_when(
      CompHrsDay == "0_hrs" ~ 0,
      CompHrsDay == "1_hr" ~ 1,
      CompHrsDay == "2_hr" ~ 2,
      CompHrsDay == "3_hr" ~ 3,
      CompHrsDay == "4_hr" ~ 4,
      CompHrsDay == "More_4_hr" ~ 5,
      TRUE ~ NA_real_
    ),
    combined_screen_time = TV_Numeric + Comp_Numeric
  ) %>%

  # The standard comes from the Patient Health Questionnaire-2 (PHQ-2), which is the 2-question screening tool being used.
  mutate(
    Score_Depressed = case_when(
      str_detect(Depressed, "None") ~ 0,
      str_detect(Depressed, "Several") ~ 1,
      str_detect(Depressed, "Most") ~ 3,
      TRUE ~ NA_real_
    ),
    Score_Interest = case_when(
      str_detect(LittleInterest, "None") ~ 0,
      str_detect(LittleInterest, "Several") ~ 1,
      str_detect(LittleInterest, "Most") ~ 3,
      TRUE ~ NA_real_
    ),
    PHQ2_Score = Score_Depressed + Score_Interest,
    
    # Create Binary Outcome: Standard cutoff for PHQ-2 is >= 3
    is_depressed_binary = ifelse(PHQ2_Score >= 3, 1, 0)
  ) %>%
  

  mutate(Gender = as.factor(Gender)) %>%
  drop_na(combined_screen_time, is_depressed_binary, Testosterone, BMI)
df
```


```{r}
# check original distribution
hist(df$Testosterone, main = "Original Testosterone", col = "lightblue")

# check log distribution
hist(log(df$Testosterone), main = "Log-Transformed Testosterone", col = "lightgreen")
```


```{r}
summary(df$combined_screen_time)
```

```{r}
table(df$is_depressed_binary)
```


```{r}
# linear model of testosterone
# Association between Screen Time and Testosterone in Men, adjusting for Age/BMI.
model_testosterone <- lm(
  log(Testosterone) ~ combined_screen_time + Age + BMI, 
  data = df
)
summary(model_testosterone)

# logistic model for depression
# Association between Screen Time and Odds of Depression in Men.
model_depression <- glm(
  is_depressed_binary ~ combined_screen_time + Age + BMI, 
  family = "binomial",
  data = df
)
summary(model_depression)
```






###Plots

```{r}
ggplot(df, aes(x = combined_screen_time, y = log(Testosterone))) +
  geom_point(alpha = 0.5, color = "#2c3e50") +  
  geom_smooth(method = "lm", color = "#e74c3c", fill = "#e74c3c", alpha = 0.2) + # Red regression line
  labs(
    title = "Screen Time vs. Testosterone (Log-Transformed)",
    subtitle = "Adjusted for Age and BMI in Male Participants",
    x = "Daily Screen Time (Hours)",
    y = "Log(Testosterone)"
  ) +
  theme_minimal()

ggplot(df, aes(x = combined_screen_time, y = is_depressed_binary)) +
  # Jitter points so they don't overlap at 0 and 1
  geom_jitter(height = 0.05, alpha = 0.3, color = "gray") + 
  geom_smooth(method = "glm", method.args = list(family = "binomial"), 
              color = "blue", se = TRUE) +
  labs(
    title = "Probability of Depression vs. Screen Time",
    y = "Probability of Depression (PHQ-2 >= 3)",
    x = "Daily Screen Time (Hours)"
  ) +
  theme_minimal()
```




### linear model of depression 
```{r}
# Linear regression for depression
model_depression_continuous <- lm(
  PHQ2_Score ~ combined_screen_time + Age + BMI, 
  data = df
)

summary(model_depression_continuous)
```


```{r}
ggplot(df, aes(x = combined_screen_time, y = PHQ2_Score)) +
  # Jitter adds random noise to position to prevent overplotting
  geom_jitter(height = 0.2, width = 0.2, alpha = 0.5, color = "#8e44ad") + 
  
  geom_smooth(method = "lm", color = "black", se = TRUE) +
  
  labs(
    title = "Screen Time vs. Depression Severity (PHQ-2 Score)",
    subtitle = "Male Participants (NHANES)",
    x = "Daily Screen Time (Hours)",
    y = "Depression Symptom Score (0-6)"
  ) +
  theme_minimal()
```


```{r}
t.test(combined_screen_time ~ PhysActive, data = df)
```

